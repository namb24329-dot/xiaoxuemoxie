<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€å¹´çº§æ±‰å­—ä¹¦å†™ç»ƒä¹ </title>
    <!-- å¼•å…¥ Tailwind CSS è¿›è¡Œç¾åŒ– -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Hanzi Writer æ ¸å¿ƒåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f9ff;
            /* é˜²æ­¢ç§»åŠ¨ç«¯ä¸‹æ‹‰åˆ·æ–°å¹²æ‰°å†™å­— */
            overscroll-behavior: none; 
        }

        .handwritten-font {
            font-family: 'ZCOOL KuaiLe', cursive;
        }

        /* ç±³å­—æ ¼èƒŒæ™¯ CSS */
        .mizige {
            background-color: #fff;
            background-image: 
                linear-gradient(0deg, transparent 49.5%, #ffd1d1 49.5%, #ffd1d1 50.5%, transparent 50.5%),
                linear-gradient(90deg, transparent 49.5%, #ffd1d1 49.5%, #ffd1d1 50.5%, transparent 50.5%),
                linear-gradient(45deg, transparent 49.5%, #ffd1d1 49.5%, #ffd1d1 50.5%, transparent 50.5%),
                linear-gradient(-45deg, transparent 49.5%, #ffd1d1 49.5%, #ffd1d1 50.5%, transparent 50.5%);
            background-size: 100% 100%;
            border: 4px solid #ff6b6b;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn {
            transition: all 0.2s;
        }
        .btn:active {
            transform: scale(0.95);
        }
        
        /* éšè—æ»šåŠ¨æ¡ä½†å…è®¸æ»šåŠ¨ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center">

    <!-- 1. æ¬¢è¿/è¾“å…¥ç•Œé¢ -->
    <div id="setup-screen" class="w-full max-w-lg p-6 bg-white rounded-2xl shadow-xl transition-all duration-300">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-2 handwritten-font">å¿«ä¹å†™æ±‰å­—</h1>
        <p class="text-gray-500 text-center mb-6 text-sm">å®¶é•¿è¯·å°†è¦ç»ƒä¹ çš„æ±‰å­—ç²˜è´´åœ¨ä¸‹é¢</p>
        
        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2">è¾“å…¥æ±‰å­— (æ¯”å¦‚: å¤©åœ°äººä½ æˆ‘ä»–)</label>
            <textarea id="input-chars" rows="4" class="w-full p-3 border-2 border-blue-200 rounded-lg focus:outline-none focus:border-blue-500 text-xl tracking-widest" placeholder="åœ¨æ­¤ç²˜è´´..."></textarea>
        </div>

        <button onclick="startApp()" class="btn w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-xl text-lg shadow-md">
            å¼€å§‹ç»ƒä¹  ğŸš€
        </button>
        
        <div class="mt-4 text-xs text-gray-400 text-center">
            * å»ºè®®ä½¿ç”¨ iPad æˆ– ç”µè„‘ è®¿é—®<br>
            * å³ä½¿æ²¡æœ‰ç½‘ç»œï¼Œåªè¦ç¼“å­˜è¿‡ä¸€æ¬¡ä¹Ÿèƒ½ç”¨
        </div>
    </div>

    <!-- 2. ç»ƒä¹ ç•Œé¢ (é»˜è®¤éšè—) -->
    <div id="practice-screen" class="hidden flex-col items-center w-full h-full max-w-2xl p-4">
        
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="w-full flex justify-between items-center mb-4 bg-white p-3 rounded-xl shadow-sm">
            <button onclick="goBack()" class="text-gray-500 hover:text-blue-500 font-bold">
                â† è¿”å›
            </button>
            <div class="text-xl font-bold text-gray-700">
                ç¬¬ <span id="current-index" class="text-blue-600">1</span> / <span id="total-count">10</span> å­—
            </div>
            <div class="w-16"></div> <!-- å ä½ç¬¦ä¿æŒå±…ä¸­ -->
        </div>

        <!-- æ±‰å­—æ˜¾ç¤ºåŒºåŸŸ (ç±³å­—æ ¼) -->
        <div class="relative mb-8">
            <div id="character-target" class="mizige rounded-xl cursor-crosshair"></div>
            <!-- æç¤ºä¿¡æ¯ -->
            <div id="feedback-msg" class="absolute -bottom-8 w-full text-center font-bold text-lg h-6 text-orange-500"></div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’®åŒºï¼šæ”¹ä¸º3åˆ—å¸ƒå±€ -->
        <div class="grid grid-cols-3 gap-3 w-full max-w-md mb-6">
            <button onclick="animateChar()" class="btn bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl shadow text-sm md:text-base">
                ğŸ‘€ çœ‹æ¼”ç¤º
            </button>
            <button onclick="startTracing()" class="btn bg-orange-400 hover:bg-orange-500 text-white font-bold py-3 rounded-xl shadow text-sm md:text-base">
                âœï¸ æçº¢
            </button>
            <button onclick="startBlindQuiz()" class="btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 rounded-xl shadow text-sm md:text-base">
                ğŸ§  é»˜å†™
            </button>
        </div>

        <!-- åº•éƒ¨åˆ‡æ¢ -->
        <div class="flex gap-4 w-full max-w-md">
            <button onclick="prevChar()" class="btn flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 rounded-xl">
                ä¸Šä¸€ä¸ª
            </button>
            <button onclick="nextChar()" class="btn flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg">
                ä¸‹ä¸€ä¸ª
            </button>
        </div>

    </div>

    <script>
        // å…¨å±€å˜é‡
        let charList = [];
        let currentIndex = 0;
        let writer = null;

        // 1. åˆå§‹åŒ–åº”ç”¨
        function startApp() {
            const input = document.getElementById('input-chars').value;
            // è¿‡æ»¤éä¸­æ–‡å­—ç¬¦ï¼Œåªä¿ç•™æ±‰å­—
            const cleaned = input.match(/[\u4e00-\u9fa5]/g);
            
            if (!cleaned || cleaned.length === 0) {
                alert("è¯·å…ˆè¾“å…¥ä¸€äº›æ±‰å­—å“¦ï¼");
                return;
            }

            charList = cleaned;
            currentIndex = 0;

            // åˆ‡æ¢ç•Œé¢
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('practice-screen').classList.remove('hidden');
            document.getElementById('practice-screen').classList.add('flex');

            updateTotalCount();
            // ç§»é™¤äº† renderCharList() è°ƒç”¨
            loadCharacter(charList[0]);
        }

        function goBack() {
            document.getElementById('practice-screen').classList.add('hidden');
            document.getElementById('practice-screen').classList.remove('hidden');
            document.getElementById('practice-screen').classList.remove('flex');
            document.getElementById('setup-screen').classList.remove('hidden');
        }

        // 2. åŠ è½½æ±‰å­—æ ¸å¿ƒé€»è¾‘
        function loadCharacter(char) {
            const container = document.getElementById('character-target');
            container.innerHTML = ''; // æ¸…ç©ºä»¥å‰çš„
            setFeedback("");
            document.getElementById('current-index').innerText = currentIndex + 1;

            // è®¡ç®—å®¹å™¨å¤§å°ï¼ˆå“åº”å¼ï¼‰
            const size = Math.min(window.innerWidth - 40, 300);
            container.style.width = size + 'px';
            container.style.height = size + 'px';

            // åˆå§‹åŒ– HanziWriter
            writer = HanziWriter.create('character-target', char, {
                width: size,
                height: size,
                padding: 10,
                showOutline: true,
                strokeAnimationSpeed: 1.5, // æ¼”ç¤ºç¨å¾®å¿«ä¸€ç‚¹
                delayBetweenStrokes: 150,
                strokeColor: '#333333',
                radicalColor: '#168F16', // éƒ¨é¦–é¢œè‰²
                outlineColor: '#DDD',
                drawingWidth: 25, // æ‰‹å†™æ—¶ç¬”ç”»ç²—ä¸€ç‚¹
                showHintAfterMisses: 1, // å†™é”™1æ¬¡åæç¤º
                highlightOnComplete: true, // å†™å®Œé—ªçƒå¥–åŠ±
            });

            // é»˜è®¤è¿›æ¥æ’­æ”¾ä¸€æ¬¡åŠ¨ç”»
            writer.animateCharacter();
            // ç§»é™¤äº† highlightCurrentListChar() è°ƒç”¨
        }

        // 3. åŠ¨ç”»æ¼”ç¤º
        function animateChar() {
            if(writer) {
                writer.showOutline(); // ç¡®ä¿æ˜¾ç¤ºè½®å»“
                writer.animateCharacter();
                setFeedback("è®¤çœŸçœ‹ç¬”ç”»é¡ºåºå“¦~", "text-green-500");
            }
        }

        // 4. æçº¢æ¨¡å¼ï¼ˆæœ‰èƒŒæ™¯ï¼‰
        function startTracing() {
            if(writer) {
                writer.showOutline(); // ç¡®ä¿æ˜¾ç¤ºè½®å»“
                setFeedback("è·Ÿç€ç°è‰²èƒŒæ™¯å†™...", "text-orange-500");
                
                runQuiz("æçº¢");
            }
        }

        // 5. é»˜å†™æ¨¡å¼ï¼ˆæ— èƒŒæ™¯ï¼‰- æ–°å¢åŠŸèƒ½
        function startBlindQuiz() {
            if(writer) {
                writer.hideOutline(); // éšè—è½®å»“
                setFeedback("å‡­è®°å¿†é»˜å†™...", "text-purple-600");
                
                runQuiz("é»˜å†™");
            }
        }

        // é€šç”¨æµ‹éªŒé€»è¾‘
        function runQuiz(modeName) {
            writer.quiz({
                onMistake: function(strokeData) {
                    setFeedback("å“å‘€ï¼Œç¬”ç”»ä¸å¯¹ï¼Œå†æƒ³æƒ³ï¼", "text-red-500");
                },
                onCorrectStroke: function(strokeData) {
                    setFeedback("å†™å¯¹äº†ï¼", "text-blue-500");
                },
                onComplete: function(summaryData) {
                    setFeedback(`å¤ªæ£’äº†ï¼${modeName}æˆåŠŸï¼ğŸ‰`, "text-green-600");
                    // é»˜å†™å®Œæˆåï¼Œæ˜¾ç¤ºå‡ºåŸå­—ï¼Œç»™å­©å­å¯¹æ¯”ä¸€ä¸‹
                    setTimeout(() => {
                        writer.showOutline();
                    }, 500);
                }
            });
        }

        // è¾…åŠ©ï¼šè®¾ç½®æç¤ºæ–‡å­—
        function setFeedback(text, colorClass) {
            const el = document.getElementById('feedback-msg');
            el.innerText = text;
            // æ¸…é™¤æ—§é¢œè‰²ï¼Œä¿ç•™åŸºç¡€å¸ƒå±€
            el.className = `absolute -bottom-8 w-full text-center font-bold text-lg h-6 ${colorClass || 'text-gray-500'}`;
        }

        // 6. å¯¼èˆªé€»è¾‘
        function nextChar() {
            if (currentIndex < charList.length - 1) {
                currentIndex++;
                loadCharacter(charList[currentIndex]);
            } else {
                alert("å·²ç»æ˜¯æœ€åä¸€ä¸ªå­—å•¦ï¼");
            }
        }

        function prevChar() {
            if (currentIndex > 0) {
                currentIndex--;
                loadCharacter(charList[currentIndex]);
            }
        }

        function updateTotalCount() {
            document.getElementById('total-count').innerText = charList.length;
        }

        // é¢„è®¾æ–¹ä¾¿æµ‹è¯•
        document.getElementById('input-chars').value = "å¤©åœ°äººä½ æˆ‘ä»–å†™å­—çœŸå¿«ä¹";
    </script>
</body>
</html>
